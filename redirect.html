<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>
  <h2>ğŸ”„ Processing Reddit Login...</h2>
  <pre id="output">Fetching karma...</pre>

  <script>
    const code = new URLSearchParams(window.location.search).get("code");
    const output = document.getElementById("output");

    if (!code) {
      output.innerText = "âŒ No code received. Login failed.";
    } else {
      fetch("https://fancy-morning-0446.ayoub-boutarfa77.workers.dev/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code })
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          output.innerText = `âŒ Error: ${data.error}`;
        } else {
          output.innerText = `ğŸ‰ Welcome, u/${data.username}\n\nğŸ”º Link Karma: ${data.linkKarma}\nğŸ’¬ Comment Karma: ${data.commentKarma}`;
        }
      })
      .catch(err => {
        output.innerText = "âŒ Something went wrong: " + err.message;
      });
    }
  </script>
</body>
</html>
